<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <base th:href="${#request.getContextPath() + '/resources_webcon/'}"/>
    <meta charset="UTF-8">
    <title>Title</title>

   <!-- <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">



    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/bootstrap.min.js"></script>-->
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <script src="js/plugins/jeditable/jquery.jeditable.js"></script>

    <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <script src="js/plugins/dataTables/datatables.min.js"></script>

    <style>
        .btn-large-dim {
            width: 80px;
            height: 80px;
            font-size: 10px;
            margin-bottom: 0px;
        }
    </style>

    <script th:inline="javascript">
        $(document).ready(function () {

            //动态计算高度
            autoHeight();

            $('.dataTables-example').DataTable({
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    {extend: 'copy'},
                    {extend: 'csv'},
                    {extend: 'excel', title: 'ExampleFile'},
                    {extend: 'pdf', title: 'ExampleFile'},

                    {
                        extend: 'print',
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                        }
                    }
                ]

            });

            var oTable = $('#editable').DataTable();

            oTable.$('td').editable('../example_ajax.php', {
                "callback": function (sValue, y) {
                    var aPos = oTable.fnGetPosition(this);
                    oTable.fnUpdate(sValue, aPos[0], aPos[1]);
                },
                "submitdata": function (value, settings) {
                    return {
                        "row_id": this.parentNode.getAttribute('id'),
                        "column": oTable.fnGetPosition(this)[2]
                    };
                },

                "width": "90%",
                "height": "100%"
            });
        });


        //点击行
        var uid;
        function click_tr(userid, ele){

            $("tbody tr:even").css("background-color", "#f9f9f9");
            $("tbody tr:odd").css("background-color", "#ffffff");

            ele.style.backgroundColor = "#dddddd";
            uid = userid;
        }

        var monitored = [[${listenStatus.containsKey('monitored') ? listenStatus.monitored : null}]];
        var monitor= [[${listenStatus.containsKey('monitor') ? listenStatus.monitor : null}]];

        //设置被监听终端
        function byListener(){

            if(!uid){
                alert("请至少选择一个终端！");
                return;
            }

            $.post([[${#request.getContextPath()}]] + "/web/clients/byListener",{"userid":uid},function(data){
                location.reload();
            });
        }

        //设置监听终端
        function listener(){

            if(!uid){
                alert("请至少选择一个终端！");
                return;
            }

            if(!monitored){
                alert("请先选择一个被监听终端！");
                return;
            }

            if(monitored == uid){
                alert("被监听终端不能再设置成监听终端");
                return;
            }

            $.post([[${#request.getContextPath()}]] + "/web/clients/listener",{"userid":uid},function(data){
                location.reload();
            });
        }

        //删除终端
        function deleteClient(){
            if(!uid){
                alert("请至少选择一个终端！");
                return;
            }

            $.post([[${#request.getContextPath()}]] + "/web/clients/delete",{"userid":uid},function(data){
                location.reload();
            });
        }

    </script>

</head>
<body>
<div class="row border-bottom white-bg dashboard-header myheader" style="padding: 10px 10px 10px 10px">

    <button class="btn btn-primary dim btn-large-dim" type="button" onclick="listener();">
        <img style="width: 50px; height: 50px; margin-bottom: 5px" src="img/1.png"/><br/>
        监听终端
    </button>
    <button class="btn btn-primary dim btn-large-dim" type="button" onclick="byListener();">
        被监听终端
    </button>
    <button class="btn btn-primary dim btn-large-dim" type="button">
        音量调节
    </button>
    <button class="btn btn-primary dim btn-large-dim" type="button" onclick="deleteClient();">
        删除终端
    </button>
    <!--<button class="btn btn-primary dim btn-large-dim" type="button">
        双向对讲
    </button>
    <button class="btn btn-primary dim btn-large-dim" type="button">
        语音帮助
    </button>-->

</div>
    <div class="animated fadeInRight">
        <div class="row">
            <div id="col-lg-12">
                <div class="ibox float-e-margins">
                <div class="ibox-content h_1">

                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover dataTables-example">
                            <thead>
                            <tr>
                                <!--<th>Rendering engine</th>
                                <th>Browser</th>
                                <th>Platform(s)</th>
                                <th>Engine version</th>
                                <th>CSS grade</th>-->

                                <th>状态</th>
                                <th>终端ID</th>
                                <th>产品型号</th>
                                <th>终端名称</th>
                                <th>MAC地址</th>
                                <th>IP地址</th>
                                <th>音量</th>
                                <th>任务状态</th>
                                <th>监听状态</th>
                                <th>固件版本</th>
                                <th>音源</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:onclick="|click_tr(${client.userid}, this);|" th:switch="${4 - #strings.length(client.userid)}" th:each="client : ${clients}" class="gradeX">
                                <th>
                                    <img style="width: 20px; height: 20px" th:src="${client.status == 1 ? 'img/on.png' : 'img/off.png'}"/>
                                </th>
                                <th th:case="${0}" th:text="${client.userid}">终端ID</th>
                                <th th:case="${1}" th:text="${'0' + client.userid}">终端ID</th>
                                <th th:case="${2}" th:text="${'00' + client.userid}">终端ID</th>
                                <th th:case="${3}" th:text="${'000' + client.userid}">终端ID</th>
                                <th th:text="${client.productsmodel}">产品型号</th>
                                <th th:text="${client.terminalname}">终端名称</th>
                                <th th:text="${client.mac}">MAC地址</th>
                                <th th:text="${client.ip}">IP地址</th>
                                <th th:text="${client.volume}">音量</th>
                                <th th:text="${client.updatestatus}">任务状态</th>
                                <th th:if="${listenStatus.containsKey('monitored') && client.userid == listenStatus.monitored}">被监听终端</th>
                               <!-- <th th:unless="${listenStatus.containsKey('monitored') && client.userid == listenStatus.monitored}"></th>-->
                                <th th:if="${listenStatus.containsKey('monitor') && client.userid == listenStatus.monitor}">监听终端</th>
                                <!--<th th:unless="${listenStatus.containsKey('monitor') && client.userid == listenStatus.monitor}"></th>-->
                                <th th:unless="${(listenStatus.containsKey('monitored') && client.userid == listenStatus.monitored) || (listenStatus.containsKey('monitor') && client.userid == listenStatus.monitor)}"></th>
                                <th></th>
                                <th></th>
                            </tr>


                            </tbody>
                            <tfoot>
                            <!--<tr>
                                <th>Rendering engine</th>
                                <th>Browser</th>
                                <th>Platform(s)</th>
                                <th>Engine version</th>
                                <th>CSS grade</th>
                            </tr>-->
                            </tfoot>
                        </table>
                    </div>

                </div>
            </div>
            </div>
        </div>
    </div>
</body>
</html>