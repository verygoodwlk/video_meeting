<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <base th:href="${#request.getContextPath() + '/'}"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Insert title here</title>
    <!-- Invalid Stylesheet. This makes stuff look pretty. Remove it if you want the CSS completely valid -->
    <!-- Reset Stylesheet -->
    <link rel="stylesheet" href="resources/css/reset.css" type="text/css"
          media="screen"/>
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="resources/css/style.css" type="text/css"
          media="screen"/>
    <link rel="stylesheet" href="resources/css/invalid.css" type="text/css"
          media="screen"/>

    <!--                       Javascripts                       -->
    <!-- jQuery -->
    <script type="text/javascript"
            src="resources/scripts/jquery-1.3.2.min.js"></script>
    <!-- jQuery Configuration
    <script type="text/javascript"
            src="resources/scripts/simpla.jquery.configuration.js"></script>-->

    <!-- 引入ztree -->
    <link rel="stylesheet" href="resources/widget/zTree/zTreeStyle/zTreeStyle.css"/>
    <script type="text/javascript" src="resources/widget/zTree/jquery.ztree.all.min.js"></script>
    <script type="text/javascript" src="resources/myjs/tree.js"></script>

    <script th:inline="javascript">
        $(function (){
            //初始化树形结构
            initClients();
        });

        /**
         * 修改终端ip地址
         */
        function updateClientIp(){
            var ip = $("#ip_address").val();
            var str = /^((25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))$/;
            if(!str.test(ip)){
                alert("ip地址的格式不正确！");
                return;
            }

            //获得被选择的终端
            var znodes = ztreeObj.getCheckedNodes(true);
            var terminal = [];
            for (var i = 0; i < znodes.length; i++) {
                if (znodes[i].isClient == 1) {
                    //如果是终端
                    terminal.push(znodes[i].userid);
                }
            }

            if(terminal.length <= 0){
                alert("终端选择不能为空！");
                return;
            }

            $.post("/client/updateip", {"ip":ip, "userids":terminal}, function(data){
                alert("终端ip修改成功！");
            }, "text");
        }
    </script>

</head>
<body>
<div id="main-content">
    <div class="content-box">
        <!-- End .content-box-header -->
        <div class="content-box-content">
            <h2>终端ip管理</h2>

            <input id="ip_address" type="text" name="ip_address" value="" placeholder="请输入终端连接的ip地址"/><br/>

            <!-- 树形选择器 -->
            <div id="ztree_div" class="ztree"></div>

            <p>
                <button class="mybutton" type="submit" onclick="updateClientIp();">修改ip</button>
            </p>

        </div>
        <!-- End .content-box-content -->
    </div>
</div>
<!-- End #main-content -->
</body>
</html>